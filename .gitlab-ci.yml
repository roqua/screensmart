image: registry.roqua.nl/roqua/rq:dd-env-fix

before_script:
  - docker login registry.roqua.nl -u "$REGISTRY_USERNAME" -p "$REGISTRY_PASSWORD"

docker:
  retry: 2
  script:
    - rq build
    - rq run bundle exec rake db:create
    - rq run bin/rails db:environment:set RAILS_ENV=test
    - rq run bundle exec rake db:schema:load
    - rq run bundle exec rspec
    - rq run bundle exec rubocop -D
    - rq push
